---
import { getCollection } from 'astro:content';
import { getBaseUrl } from '../utils/paths';

const baseUrl = getBaseUrl();

// 最新の記事を3件取得
const latestNews = await getCollection('news', ({ data }) => {
  return data.draft !== true;
});

const sortedNews = latestNews
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())
  .slice(0, 3);

// カテゴリ別の色定義
const getCategoryColor = (category: string) => {
  const colors = {
    news: 'natural-green',
    blog: 'vibrant-orange', 
    project: 'natural-brown',
    event: 'warm-yellow',
    update: 'natural-light-green'
  };
  return colors[category as keyof typeof colors] || 'natural-green';
};

// カテゴリ別の日本語表示
const getCategoryLabel = (category: string) => {
  const labels = {
    news: 'ニュース',
    blog: 'コラム',
    project: 'プロジェクト',
    event: 'イベント',
    update: 'アップデート'
  };
  return labels[category as keyof typeof labels] || category;
};
---

<section class="py-16 bg-natural-beige/10">
  <div class="section-padding">
    <div class="max-w-6xl mx-auto">
      <!-- セクションヘッダー -->
      <div class="text-center mb-12">
        <h2 class="text-3xl font-sans font-bold text-natural-brown mb-4">
          最新のお知らせ
        </h2>
        <p class="text-gray-600 text-lg">
          Wells合同会社の最新情報をご紹介します
        </p>
      </div>

      <!-- 記事一覧 -->
      {sortedNews.length > 0 ? (
        <div class="max-w-3xl mx-auto mb-8">
          <ul class="space-y-4">
            {sortedNews.map((entry) => (
              <li class="flex items-center gap-4 p-4 bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow">
                <div class="flex items-center gap-2">
                  <span class={`inline-block px-2 py-1 rounded-full text-xs font-medium text-white bg-${getCategoryColor(entry.data.category)}`}>
                    {getCategoryLabel(entry.data.category)}
                  </span>
                  {entry.data.featured && (
                    <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium text-vibrant-orange bg-vibrant-orange/10">
                      <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                      </svg>
                      注目
                    </span>
                  )}
                </div>
                
                <div class="flex-1">
                  <h3 class="font-bold text-natural-brown">
                    <a href={`${baseUrl}news/${entry.slug}/`} class="hover:text-vibrant-orange transition-colors">
                      {entry.data.title}
                    </a>
                  </h3>
                </div>
                
                <time class="text-sm text-gray-500" datetime={entry.data.date.toISOString()}>
                  {entry.data.date.toLocaleDateString('ja-JP', {
                    month: 'numeric',
                    day: 'numeric'
                  })}
                </time>
              </li>
            ))}
          </ul>
        </div>
      ) : (
        <div class="text-center py-12">
          <p class="text-gray-500">記事がありません</p>
        </div>
      )}

      <!-- 「すべて見る」ボタン -->
      <div class="text-center">
        <a 
          href={`${baseUrl}news/`} 
          class="inline-block bg-natural-green text-white px-8 py-3 rounded-full hover:bg-vibrant-orange transition-colors font-medium shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all"
        >
          すべてのお知らせを見る
        </a>
      </div>
    </div>
  </div>
</section>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>