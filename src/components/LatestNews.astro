---
import { getCollection } from 'astro:content';
import { getBaseUrl, joinPath } from '../utils/paths';
import NewsListItem from './NewsListItem.astro';

const baseUrl = getBaseUrl();

// 最新の記事を3件取得
const latestNews = await getCollection('news', ({ data }) => {
  return data.draft !== true;
});

const sortedNews = latestNews
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())
  .slice(0, 3);
---

<section class="py-16 bg-natural-beige/10">
  <div class="section-padding">
    <div class="max-w-6xl mx-auto">
      <!-- セクションヘッダー -->
      <div class="text-center mb-12">
        <h2 class="text-3xl font-sans font-bold text-natural-brown mb-4">
          最新のお知らせ
        </h2>
        <p class="text-gray-600 text-lg">
          Wells合同会社の最新情報をご紹介します
        </p>
      </div>

      <!-- 記事一覧 -->
      {sortedNews.length > 0 ? (
        <div class="max-w-3xl mx-auto mb-8">
          <ul class="space-y-4">
            {sortedNews.map((entry) => (
              <NewsListItem entry={entry} />
            ))}
          </ul>
        </div>
      ) : (
        <div class="text-center py-12">
          <p class="text-gray-500">記事がありません</p>
        </div>
      )}

      <!-- 「すべて見る」ボタン -->
      <div class="text-center">
        <a 
          href={joinPath(baseUrl, 'news')} 
          class="inline-block bg-natural-green text-white px-8 py-3 rounded-full hover:bg-vibrant-orange transition-colors font-medium shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all"
        >
          すべてのお知らせを見る
        </a>
      </div>
    </div>
  </div>
</section>

