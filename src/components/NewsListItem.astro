---
import { getBaseUrl } from '../utils/paths';

interface Props {
  entry: {
    slug: string;
    data: {
      title: string;
      date: Date;
      category: string;
      featured?: boolean;
    };
  };
}

const { entry } = Astro.props;
const baseUrl = getBaseUrl();

// カテゴリ別の色定義
const getCategoryColor = (category: string) => {
  const colors: Record<string, string> = {
    news: 'natural-green',
    blog: 'vibrant-orange',
    project: 'natural-brown',
    event: 'warm-yellow',
    update: 'natural-light-green'
  };
  return colors[category] || 'natural-green';
};

// カテゴリ別の日本語表示
const getCategoryLabel = (category: string) => {
  const labels: Record<string, string> = {
    news: 'ニュース',
    blog: 'コラム',
    project: 'プロジェクト',
    event: 'イベント',
    update: 'アップデート'
  };
  return labels[category] || category;
};

const articleUrl = `${baseUrl}news/${entry.slug}/`;
---

<li
  class="news-list-item flex items-center gap-4 p-4 bg-white rounded-lg shadow-sm hover:shadow-md transition-all cursor-pointer"
  data-href={articleUrl}
>
  <div class="flex items-center gap-2">
    <span class={`inline-block px-2 py-1 rounded-full text-xs font-medium text-white bg-${getCategoryColor(entry.data.category)}`}>
      {getCategoryLabel(entry.data.category)}
    </span>
    {entry.data.featured && (
      <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium text-vibrant-orange bg-vibrant-orange/10">
        <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
          <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
        </svg>
        注目
      </span>
    )}
  </div>

  <div class="flex-1">
    <h3 class="font-bold text-natural-brown">
      <a href={articleUrl} class="hover:text-vibrant-orange transition-colors">
        {entry.data.title}
      </a>
    </h3>
  </div>

  <time class="text-sm text-gray-500" datetime={entry.data.date.toISOString()}>
    {entry.data.date.toLocaleDateString('ja-JP', {
      month: 'numeric',
      day: 'numeric'
    })}
  </time>
</li>

<script>
  // リストアイテム全体クリックで記事ページへ遷移
  document.addEventListener('DOMContentLoaded', () => {
    const newsItems = document.querySelectorAll('.news-list-item[data-href]');

    newsItems.forEach(item => {
      item.addEventListener('click', (e) => {
        const target = e.target as HTMLElement;
        // リンクをクリックした場合は何もしない
        if (target.closest('a')) {
          return;
        }
        const href = item.getAttribute('data-href');
        if (href) {
          window.location.href = href;
        }
      });
    });
  });
</script>
