---
import { getBaseUrl } from '../utils/paths';

interface Props {
  entry: {
    slug: string;
    data: {
      title: string;
      description: string;
      date: Date;
      category: string;
      tags?: string[];
      featured?: boolean;
      author?: string;
    };
  };
  showAuthor?: boolean;
}

const { entry, showAuthor = false } = Astro.props;
const baseUrl = getBaseUrl();

// カテゴリ別の色定義
const getCategoryColor = (category: string) => {
  const colors: Record<string, string> = {
    news: 'natural-green',
    blog: 'vibrant-orange',
    project: 'natural-brown',
    event: 'warm-yellow',
    update: 'natural-light-green'
  };
  return colors[category] || 'natural-green';
};

// カテゴリ別の日本語表示
const getCategoryLabel = (category: string) => {
  const labels: Record<string, string> = {
    news: 'ニュース',
    blog: 'コラム',
    project: 'プロジェクト',
    event: 'イベント',
    update: 'アップデート'
  };
  return labels[category] || category;
};

const articleUrl = `${baseUrl}news/${entry.slug}/`;
---

<article
  class="news-card bg-white rounded-xl p-6 shadow-sm border-l-4 border-vibrant-orange hover:shadow-lg transition-all cursor-pointer"
  data-href={articleUrl}
>
  <!-- カテゴリとメタ情報 -->
  <div class="flex flex-wrap items-center gap-4 mb-4">
    <span class={`inline-block px-3 py-1 rounded-full text-sm font-medium text-white bg-${getCategoryColor(entry.data.category)}`}>
      {getCategoryLabel(entry.data.category)}
    </span>
    <time class="text-sm text-gray-500" datetime={entry.data.date.toISOString()}>
      {entry.data.date.toLocaleDateString('ja-JP', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      })}
    </time>
    {entry.data.featured && (
      <a
        href={`${baseUrl}news/featured/`}
        class="inline-flex items-center px-2 py-1 rounded text-xs font-medium text-vibrant-orange bg-vibrant-orange/10 hover:bg-vibrant-orange/20 transition-colors"
      >
        <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
          <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
        </svg>
        注目
      </a>
    )}
  </div>

  <!-- タイトルと説明 -->
  <h2 class="text-xl md:text-2xl font-bold text-natural-brown mb-3">
    <a href={articleUrl} class="hover:text-vibrant-orange transition-colors">
      {entry.data.title}
    </a>
  </h2>

  <p class="text-gray-700 mb-4 leading-relaxed">
    {entry.data.description}
  </p>

  <!-- タグ -->
  {entry.data.tags && entry.data.tags.length > 0 && (
    <div class="flex flex-wrap gap-2 mb-4">
      {entry.data.tags.map((tag) => (
        <a
          href={`${baseUrl}news/tags/${tag}/`}
          class="bg-natural-beige/50 text-natural-brown px-3 py-1 rounded-full text-sm hover:bg-natural-green/10 hover:text-natural-green transition-colors"
        >
          #{tag}
        </a>
      ))}
    </div>
  )}

  <!-- フッター -->
  <div class="flex items-center justify-between">
    {showAuthor && entry.data.author && (
      <span class="text-sm text-gray-500">
        by {entry.data.author}
      </span>
    )}
    {!showAuthor && <span></span>}
    <a
      href={articleUrl}
      class="inline-flex items-center text-natural-green hover:text-vibrant-orange transition-colors font-medium"
    >
      続きを読む
      <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
      </svg>
    </a>
  </div>
</article>

<script>
  // カード全体クリックで記事ページへ遷移
  document.addEventListener('DOMContentLoaded', () => {
    const newsCards = document.querySelectorAll('.news-card[data-href]');

    newsCards.forEach(card => {
      card.addEventListener('click', (e) => {
        const target = e.target as HTMLElement;
        // タグやバッジのリンクをクリックした場合は何もしない
        if (target.closest('a')) {
          return;
        }
        const href = card.getAttribute('data-href');
        if (href) {
          window.location.href = href;
        }
      });
    });
  });
</script>
